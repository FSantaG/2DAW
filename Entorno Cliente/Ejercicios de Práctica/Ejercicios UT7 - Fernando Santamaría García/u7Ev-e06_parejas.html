<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ejemplo "Correcto"</title>
    <style>
      tr,
      td {
        background-color: pink;
        /*padding: 30px;*/
        margin: 15px;
      }
      img {
        height: 100px;
        width: 75px;
        visibility: hidden;
      }
    </style>
  </head>
  <body>
    <table id="cartas">
      <tr>
        <td><img src="Simpson/AbrahamSimpson.png" /></td>
        <td><img src="Simpson/BartSimpson.png" /></td>
        <td><img src="Simpson/HomerSimpson.png" /></td>
        <td><img src="Simpson/LisaSimpson.png" /></td>
      </tr>
      <tr>
        <td><img src="Simpson/LisaSimpson.png" /></td>
        <td><img src="Simpson/AbrahamSimpson.png" /></td>
        <td><img src="Simpson/MaggieSimpson.png" /></td>
        <td><img src="Simpson/BartSimpson.png" /></td>
      </tr>
      <tr>
        <td><img src="Simpson/MaggieSimpson.png" /></td>
        <td><img src="Simpson/HomerSimpson.png" /></td>
        <td><img src="Simpson/MargeSimpson.png" /></td>
        <td><img src="Simpson/MargeSimpson.png" /></td>
      </tr>
    </table>
    <input type="text" id="contador" value="0" readonly="readonly" />
    <p id="mensaje"></p>
    <button id="reiniciar">Reiniciar el juego</button>

    <script>
      let contador = 0;
      let cartasVolteadas = [];

      //SELECCION DE TODAS LAS CELDAS E IMAGENES
      let cartasAll = document.querySelectorAll("td");
      let imgAll = document.querySelectorAll("img");

      let cuadroTexto = document.getElementById("contador");

      //EVENTO DE LAS CARTAS
      cartas.onclick = function (e) {
        let i = 0;
        let carta = e.target;

        //Si el click esta fuera de las celdas, salir del evento
        if (carta.tagName != "TD") {
          return;
        }

        //Si la carta ya es visible, salir del evento
        if (carta.firstChild.style.visibility == "visible") {
          return;
        } else {
          carta.firstChild.style.visibility = "visible";
          carta.style.backgroundColor = "aqua";
          cartasVolteadas.push(carta.firstChild);
        }

        if (cartasVolteadas.length % 2 == 0) {
          if (
            cartasVolteadas[cartasVolteadas.length - 1].getAttribute("src") ==
            cartasVolteadas[cartasVolteadas.length - 2].getAttribute("src")
          ) {
            cuadroTexto.value = ++contador;
          } else {
            setTimeout("esconderCartas()", 800);
          }
        }

        //let cartasVisibles = document.querySelectorAll("img[style = 'visibility: visible;']");
        if (contador == 6) {
          let mensaje = document.getElementById("mensaje");
          setTimeout((mensaje.innerText = "¡¡GANASTE!!"), 1000);
        }
      };

      //EVENTO DEL BOTON
      reiniciar.onclick = function () {
        resetearJuego();
      };

      //FUNCIONES
      function esconderCartas() {
        cartasVolteadas[cartasVolteadas.length - 1].style.visibility = "hidden";
        cartasVolteadas[cartasVolteadas.length - 2].style.visibility = "hidden";
        cartasVolteadas[
          cartasVolteadas.length - 1
        ].parentNode.style.backgroundColor = "pink";
        cartasVolteadas[
          cartasVolteadas.length - 2
        ].parentNode.style.backgroundColor = "pink";
      }

      //No funciona bien, repite cartas
      function resetearJuego() {
        imgAll = Array.from(imgAll);
        imgAll.forEach((element) => {
          element.style.visibility = "hidden";
          element.parentNode.style.backgroundColor = "pink";
        });

        let imgSorted = imgAll.sort(Math.random() - 0.5);

        for (let i = 0; i <= 11; i++) {
          cartasAll[i].firstChild.setAttribute(
            "src",
            imgSorted[i].getAttribute("src")
          );
        }
        contador = 0;
        cuadroTexto.value = contador;
        let mensaje = document.getElementById("mensaje");
        mensaje.innerText = "";
      }
    </script>
  </body>
</html>
